!function(n,p){Croppic=function(o,t){var e=this;for(i in e.id=o,e.obj=$("#"+o),e.outputDiv=e.obj,e.options={uploadUrl:"",uploadData:{},cropUrl:"",cropData:{},outputUrlId:"",imgEyecandy:!0,imgEyecandyOpacity:.2,zoomFactor:10,rotateFactor:5,doubleZoomControls:!0,rotateControls:!0,modal:!1,customUploadButtonId:"",loaderHtml:"",scaleToFill:!0,processInline:!1,loadPicture:"",onReset:null,enableMousescroll:!1,onBeforeImgUpload:null,onAfterImgUpload:null,onImgDrag:null,onImgZoom:null,onImgRotate:null,onBeforeImgCrop:null,onAfterImgCrop:null,onBeforeRemoveCroppedImg:null,onAfterRemoveCroppedImg:null,onError:null},t)e.options[i]=t[i];e.init()},Croppic.prototype={id:"",imgInitW:0,imgInitH:0,imgW:0,imgH:0,objW:0,objH:0,actualRotation:0,windowW:0,windowH:$(n).height(),obj:{},outputDiv:{},outputUrlObj:{},img:{},defaultImg:{},croppedImg:{},imgEyecandy:{},form:{},iframeform:{},iframeobj:{},cropControlsUpload:{},cropControlsCrop:{},cropControlZoomMuchIn:{},cropControlZoomMuchOut:{},cropControlZoomIn:{},cropControlZoomOut:{},cropControlCrop:{},cropControlReset:{},cropControlRemoveCroppedImage:{},modal:{},loader:{},init:function(){var o=this;o.objW=o.obj.width(),o.objH=o.obj.height(),o.actualRotation=0,$.isEmptyObject(o.defaultImg)&&(o.defaultImg=o.obj.find("img")),o.createImgUploadControls(),$.isEmptyObject(o.options.loadPicture)?o.bindImgUploadControl():o.loadExistingImage()},createImgUploadControls:function(){var o=this,t="";""===o.options.customUploadButtonId&&(t='<i class="cropControlUpload"></i>');var e='<i class="cropControlRemoveCroppedImage"></i>';$.isEmptyObject(o.croppedImg)&&(e=""),$.isEmptyObject(o.options.loadPicture)||(t="");var n='<div class="cropControls cropControlsUpload"> '+t+e+" </div>";o.outputDiv.append(n),o.cropControlsUpload=o.outputDiv.find(".cropControlsUpload"),""===o.options.customUploadButtonId?o.imgUploadControl=o.outputDiv.find(".cropControlUpload"):(o.imgUploadControl=$("#"+o.options.customUploadButtonId),o.imgUploadControl.show()),$.isEmptyObject(o.croppedImg)||(o.cropControlRemoveCroppedImage=o.outputDiv.find(".cropControlRemoveCroppedImage"))},bindImgUploadControl:function(){var e=this,o='<form class="'+e.id+'_imgUploadForm" style="visibility: hidden;">  <input type="file" name="img" id="'+e.id+'_imgUploadField">  </form>';e.outputDiv.append(o),e.form=e.outputDiv.find("."+e.id+"_imgUploadForm");var t=e.CreateFallbackIframe();e.imgUploadControl.off("click"),e.imgUploadControl.on("click",function(){""===t?e.form.find('input[type="file"]').trigger("click"):e.iframeform.find('input[type="file"]').trigger("click")}),$.isEmptyObject(e.croppedImg)||e.cropControlRemoveCroppedImage.on("click",function(){typeof e.options.onBeforeRemoveCroppedImg==typeof Function&&e.options.onBeforeRemoveCroppedImg.call(e),e.croppedImg.remove(),e.croppedImg={},$(this).hide(),typeof e.options.onAfterRemoveCroppedImg==typeof Function&&e.options.onAfterRemoveCroppedImg.call(e),$.isEmptyObject(e.defaultImg)||e.obj.append(e.defaultImg),""!==e.options.outputUrlId&&$("#"+e.options.outputUrlId).val("")}),e.form.find('input[type="file"]').change(function(){if(e.options.onBeforeImgUpload&&e.options.onBeforeImgUpload.call(e),e.showLoader(),e.imgUploadControl.hide(),e.options.processInline){var o;"undefined"==typeof FileReader?(e.options.onError&&e.options.onError.call(e,"processInline is not supported by your Browser"),e.reset()):((o=new FileReader).onload=function(o){var t=new Image;t.src=o.target.result,t.onload=function(){e.imgInitW=e.imgW=t.width,e.imgInitH=e.imgH=t.height,e.options.modal&&e.createModal(),$.isEmptyObject(e.croppedImg)||e.croppedImg.remove(),e.imgUrl=t.src,e.obj.append('<img src="'+t.src+'">'),e.initCropper(),e.hideLoader(),e.options.onAfterImgUpload&&e.options.onAfterImgUpload.call(e)}},o.readAsDataURL(e.form.find('input[type="file"]')[0].files[0]))}else{try{formData=new FormData(e.form[0])}catch(o){formData=new FormData,formData.append("img",e.form.find("input[type=file]")[0].files[0])}for(var t in e.options.uploadData)e.options.uploadData.hasOwnProperty(t)&&formData.append(t,e.options.uploadData[t]);$.ajax({url:e.options.uploadUrl,data:formData,context:p.body,cache:!1,contentType:!1,processData:!1,type:"POST"}).always(function(o){e.afterUpload(o)})}})},loadExistingImage:function(){var o,t=this;$.isEmptyObject(t.croppedImg)?(t.options.onBeforeImgUpload&&t.options.onBeforeImgUpload.call(t),t.showLoader(),t.options.modal&&t.createModal(),$.isEmptyObject(t.croppedImg)||t.croppedImg.remove(),t.imgUrl=t.options.loadPicture,o=$('<img src="'+t.options.loadPicture+'">'),t.obj.append(o),o.load(function(){t.imgInitW=t.imgW=this.width,t.imgInitH=t.imgH=this.height,t.initCropper(),t.hideLoader(),t.options.onAfterImgUpload&&t.options.onAfterImgUpload.call(t)})):t.cropControlRemoveCroppedImage.on("click",function(){t.croppedImg.remove(),$(this).hide(),$.isEmptyObject(t.defaultImg)||t.obj.append(t.defaultImg),""!==t.options.outputUrlId&&$("#"+t.options.outputUrlId).val(""),t.croppedImg="",t.reset()})},afterUpload:function(o){var t,e=this;response="object"==typeof o?o:jQuery.parseJSON(o),"success"==response.status&&(e.imgInitW=e.imgW=response.width,e.imgInitH=e.imgH=response.height,e.options.modal&&e.createModal(),$.isEmptyObject(e.croppedImg)||e.croppedImg.remove(),e.imgUrl=response.url,t=$('<img src="'+response.url+'">'),e.obj.append(t),t.load(function(){e.initCropper(),e.hideLoader(),e.options.onAfterImgUpload&&e.options.onAfterImgUpload.call(e)}),e.options.onAfterImgUpload&&e.options.onAfterImgUpload.call(e)),"error"==response.status&&(alert(response.message),e.options.onError&&e.options.onError.call(e,response.message),e.hideLoader(),setTimeout(function(){e.reset()},2e3))},createModal:function(){var o=this,t=o.windowH/2-o.objH/2,e='<div id="croppicModal"><div id="croppicModalObj" style="width:'+o.objW+"px; height:"+o.objH+"px; margin:0 auto; margin-top:"+t+'px; position: relative;"> </div></div>';$("body").append(e),o.modal=$("#croppicModal"),o.obj=$("#croppicModalObj")},destroyModal:function(){var o=this;o.obj=o.outputDiv,o.modal.remove(),o.modal={}},initCropper:function(){var o=this;o.img=o.obj.find("img"),o.img.wrap('<div class="cropImgWrapper" style="overflow:hidden; z-index:1; position:absolute; width:'+o.objW+"px; height:"+o.objH+'px;"></div>'),o.createCropControls(),o.options.imgEyecandy&&o.createEyecandy(),o.initDrag(),o.initialScaleImg()},createEyecandy:function(){var o=this;o.imgEyecandy=o.img.clone(),o.imgEyecandy.css({"z-index":"0",opacity:o.options.imgEyecandyOpacity}).appendTo(o.obj)},destroyEyecandy:function(){this.imgEyecandy.remove()},initialScaleImg:function(){var t=this;t.zoom(-t.imgInitW),t.zoom(40),t.options.enableMousescroll&&t.img.on("mousewheel",function(o){o.preventDefault(),t.zoom(t.options.zoomFactor*o.deltaY)}),t.img.css({left:-(t.imgW-t.objW)/2,top:-(t.imgH-t.objH)/2,position:"relative"}),t.options.imgEyecandy&&t.imgEyecandy.css({left:-(t.imgW-t.objW)/2,top:-(t.imgH-t.objH)/2,position:"relative"})},createCropControls:function(){var o,t=this,e="",n="",i="",r="";t.options.doubleZoomControls&&(e='<i class="cropControlZoomMuchIn"></i>',n='<i class="cropControlZoomMuchOut"></i>'),t.options.rotateControls&&(i='<i class="cropControlRotateLeft"></i>',r='<i class="cropControlRotateRight"></i>'),o='<div class="cropControls cropControlsCrop">'+e+'<i class="cropControlZoomIn"></i><i class="cropControlZoomOut"></i>'+n+i+r+'<i class="cropControlCrop"></i><i class="cropControlReset"></i></div>',t.obj.append(o),t.cropControlsCrop=t.obj.find(".cropControlsCrop"),t.options.doubleZoomControls&&(t.cropControlZoomMuchIn=t.cropControlsCrop.find(".cropControlZoomMuchIn"),t.cropControlZoomMuchIn.on("click",function(){t.zoom(10*t.options.zoomFactor)}),t.cropControlZoomMuchOut=t.cropControlsCrop.find(".cropControlZoomMuchOut"),t.cropControlZoomMuchOut.on("click",function(){t.zoom(10*-t.options.zoomFactor)})),t.cropControlZoomIn=t.cropControlsCrop.find(".cropControlZoomIn"),t.cropControlZoomIn.on("click",function(){t.zoom(t.options.zoomFactor)}),t.cropControlZoomOut=t.cropControlsCrop.find(".cropControlZoomOut"),t.cropControlZoomOut.on("click",function(){t.zoom(-t.options.zoomFactor)}),t.cropControlZoomIn=t.cropControlsCrop.find(".cropControlRotateLeft"),t.cropControlZoomIn.on("click",function(){t.rotate(-t.options.rotateFactor)}),t.cropControlZoomOut=t.cropControlsCrop.find(".cropControlRotateRight"),t.cropControlZoomOut.on("click",function(){t.rotate(t.options.rotateFactor)}),t.cropControlCrop=t.cropControlsCrop.find(".cropControlCrop"),t.cropControlCrop.on("click",function(){t.crop()}),t.cropControlReset=t.cropControlsCrop.find(".cropControlReset"),t.cropControlReset.on("click",function(){t.reset()})},initDrag:function(){var m=this;m.img.on("mousedown touchstart",function(o){var t;o.preventDefault();var r=n.navigator.userAgent,e=r.match(/iPad/i)||r.match(/iPhone/i)||r.match(/android/i)||null==(o.pageY&&o.pageX)?(t=o.originalEvent.touches[0].pageX,o.originalEvent.touches[0].pageY):(t=o.pageX,o.pageY),a=m.img.css("z-index"),p=m.img.outerHeight(),s=m.img.outerWidth(),c=m.img.offset().top+p-e,l=m.img.offset().left+s-t;m.img.css("z-index",1e3).on("mousemove touchmove",function(o){var t,e,n,i=r.match(/iPad/i)||r.match(/iPhone/i)||r.match(/android/i)||null==(o.pageY&&o.pageX)?(t=o.originalEvent.touches[0].pageY+c-p,o.originalEvent.touches[0].pageX+l-s):(t=o.pageY+c-p,o.pageX+l-s);m.img.offset({top:t,left:i}).on("mouseup",function(){$(this).removeClass("draggable").css("z-index",a)}),m.options.imgEyecandy&&m.imgEyecandy.offset({top:t,left:i}),m.objH<m.imgH?(0<parseInt(m.img.css("top"))&&(m.img.css("top",0),m.options.imgEyecandy&&m.imgEyecandy.css("top",0)),e=-(m.imgH-m.objH),parseInt(m.img.css("top"))<e&&(m.img.css("top",e),m.options.imgEyecandy&&m.imgEyecandy.css("top",e))):(parseInt(m.img.css("top"))<0&&(m.img.css("top",0),m.options.imgEyecandy&&m.imgEyecandy.css("top",0)),e=m.objH-m.imgH,parseInt(m.img.css("top"))>e&&(m.img.css("top",e),m.options.imgEyecandy&&m.imgEyecandy.css("top",e))),m.objW<m.imgW?(0<parseInt(m.img.css("left"))&&(m.img.css("left",0),m.options.imgEyecandy&&m.imgEyecandy.css("left",0)),n=-(m.imgW-m.objW),parseInt(m.img.css("left"))<n&&(m.img.css("left",n),m.options.imgEyecandy&&m.imgEyecandy.css("left",n))):(parseInt(m.img.css("left"))<0&&(m.img.css("left",0),m.options.imgEyecandy&&m.imgEyecandy.css("left",0)),n=m.objW-m.imgW,parseInt(m.img.css("left"))>n&&(m.img.css("left",n),m.options.imgEyecandy&&m.imgEyecandy.css("left",n))),m.options.onImgDrag&&m.options.onImgDrag.call(m)})}).on("mouseup",function(){m.img.off("mousemove")}).on("mouseout",function(){m.img.off("mousemove")})},rotate:function(o){var t=this;t.actualRotation+=o,t.img.css({"-webkit-transform":"rotate("+t.actualRotation+"deg)","-moz-transform":"rotate("+t.actualRotation+"deg)",transform:"rotate("+t.actualRotation+"deg)"}),t.options.imgEyecandy&&t.imgEyecandy.css({"-webkit-transform":"rotate("+t.actualRotation+"deg)","-moz-transform":"rotate("+t.actualRotation+"deg)",transform:"rotate("+t.actualRotation+"deg)"}),"function"==typeof t.options.onImgRotate&&t.options.onImgRotate.call(t)},zoom:function(o){var t=this,e=t.imgW/t.imgH,n=t.imgW+o,i=n/e,r=!0;(n<t.objW||i<t.objH)&&(n-t.objW<i-t.objH?i=(n=t.objW)/e:n=e*(i=t.objH),r=!1),!t.options.scaleToFill&&(n>t.imgInitW||i>t.imgInitH)&&(n-t.imgInitW<i-t.imgInitH?i=(n=t.imgInitW)/e:n=e*(i=t.imgInitH),r=!1),t.imgW=n,t.img.width(n),t.imgH=i,t.img.height(i);var a=parseInt(t.img.css("top"))-o/2,p=parseInt(t.img.css("left"))-o/2;0<a&&(a=0),0<p&&(p=0);var s=-(i-t.objH);a<s&&(a=s);var c=-(n-t.objW);p<c&&(p=c),r&&t.img.css({top:a,left:p}),t.options.imgEyecandy&&(t.imgEyecandy.width(n),t.imgEyecandy.height(i),r&&t.imgEyecandy.css({top:a,left:p})),t.options.onImgZoom&&t.options.onImgZoom.call(t)},crop:function(){var t=this;t.options.onBeforeImgCrop&&t.options.onBeforeImgCrop.call(t),t.cropControlsCrop.hide(),t.showLoader();var o,e={imgUrl:t.imgUrl,imgInitW:t.imgInitW,imgInitH:t.imgInitH,imgW:t.imgW,imgH:t.imgH,imgY1:Math.abs(parseInt(t.img.css("top"))),imgX1:Math.abs(parseInt(t.img.css("left"))),cropH:t.objH,cropW:t.objW,rotation:t.actualRotation};if("undefined"==typeof FormData){var n,i=new XMLHttpRequest,r=[];for(var a in e)r.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));for(var a in t.options.cropData)r.push(encodeURIComponent(a)+"="+encodeURIComponent(t.options.cropData[a]));n=r.join("&").replace(/%20/g,"+"),i.addEventListener("error",function(o){t.options.onError&&t.options.onError.call(t,"XHR Request failed")}),i.onreadystatechange=function(){4==i.readyState&&200==i.status&&t.afterCrop(i.responseText)},i.open("POST",t.options.cropUrl),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.setRequestHeader("Content-Length",n.length),i.send(n)}else{for(var a in o=new FormData,e)e.hasOwnProperty(a)&&o.append(a,e[a]);for(var a in t.options.cropData)t.options.cropData.hasOwnProperty(a)&&o.append(a,t.options.cropData[a]);$.ajax({url:t.options.cropUrl,data:o,context:p.body,cache:!1,contentType:!1,processData:!1,type:"POST"}).always(function(o){t.afterCrop(o)})}},afterCrop:function(t){var o=this;try{response=jQuery.parseJSON(t)}catch(o){response="object"==typeof t?t:jQuery.parseJSON(t)}"success"==response.status&&(o.options.imgEyecandy&&o.imgEyecandy.hide(),o.destroy(),o.obj.append('<img class="croppedImg" src="'+response.url+'">'),""!==o.options.outputUrlId&&$("#"+o.options.outputUrlId).val(response.url),o.croppedImg=o.obj.find(".croppedImg"),o.init(),o.hideLoader()),"error"==response.status&&(o.options.onError&&o.options.onError.call(o,response.message),o.hideLoader(),setTimeout(function(){o.reset()},2e3)),o.options.onAfterImgCrop&&o.options.onAfterImgCrop.call(o,response)},showLoader:function(){this.obj.append(this.options.loaderHtml),this.loader=this.obj.find(".loader")},hideLoader:function(){this.loader.remove()},reset:function(){var o=this;o.destroy(),o.init(),$.isEmptyObject(o.croppedImg)||(o.obj.append(o.croppedImg),""!==o.options.outputUrlId&&$("#"+o.options.outputUrlId).val(o.croppedImg.attr("url"))),"function"==typeof o.options.onReset&&o.options.onReset.call(o)},destroy:function(){var o=this;o.options.modal&&!$.isEmptyObject(o.modal)&&o.destroyModal(),o.options.imgEyecandy&&!$.isEmptyObject(o.imgEyecandy)&&o.destroyEyecandy(),$.isEmptyObject(o.cropControlsUpload)||o.cropControlsUpload.remove(),$.isEmptyObject(o.cropControlsCrop)||o.cropControlsCrop.remove(),$.isEmptyObject(o.loader)||o.loader.remove(),$.isEmptyObject(o.form)||o.form.remove(),o.obj.html("")},isAjaxUploadSupported:function(){var o=p.createElement("input");return o.type="file","multiple"in o&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&void 0!==(new XMLHttpRequest).upload},CreateFallbackIframe:function(){var t,e=this;if(e.isAjaxUploadSupported())return"";jQuery.isEmptyObject(e.iframeobj)?((t=p.createElement("iframe")).setAttribute("id",e.id+"_upload_iframe"),t.setAttribute("name",e.id+"_upload_iframe"),t.setAttribute("width","0"),t.setAttribute("height","0"),t.setAttribute("border","0"),t.setAttribute("src","javascript:false;"),t.style.display="none",p.body.appendChild(t)):t=e.iframeobj[0];var o='<!DOCTYPE html><html><head><title>Uploading File</title></head><body><form class="'+e.id+'_upload_iframe_form" name="'+e.id+'_upload_iframe_form" action="'+e.options.uploadUrl+'" method="post" enctype="multipart/form-data" encoding="multipart/form-data" style="display:none;">'+$("#"+e.id+"_imgUploadField")[0].outerHTML+"</form></body></html>";t.contentWindow.document.open("text/htmlreplace"),t.contentWindow.document.write(o),t.contentWindow.document.close(),e.iframeobj=$("#"+e.id+"_upload_iframe"),e.iframeform=e.iframeobj.contents().find("html").find("."+e.id+"_upload_iframe_form"),e.iframeform.on("change","input",function(){e.SubmitFallbackIframe(e)}),e.iframeform.find("input")[0].attachEvent("onchange",function(){e.SubmitFallbackIframe(e)});var n=function(){t.detachEvent?t.detachEvent("onload",n):t.removeEventListener("load",n,!1);var o=e.getIframeContentJSON(t);jQuery.isEmptyObject(e.modal)&&e.afterUpload(o)};return t.addEventListener&&t.addEventListener("load",n,!0),t.attachEvent&&t.attachEvent("onload",n),"#"+e.id+"_imgUploadField"},SubmitFallbackIframe:function(o){o.showLoader(),o.options.processInline&&!o.options.uploadUrl?o.options.onError&&(o.options.onError.call(o,"processInline is not supported by your browser "),o.hideLoader()):(o.options.onBeforeImgUpload&&o.options.onBeforeImgUpload.call(o),o.iframeform[0].submit())},getIframeContentJSON:function(o){try{var t,e=o.contentDocument?o.contentDocument:o.contentWindow.document,n=e.body.innerHTML;"<pre>"==n.slice(0,5).toLowerCase()&&"</pre>"==n.slice(-6).toLowerCase()&&(n=e.body.firstChild.firstChild.nodeValue),t=jQuery.parseJSON(n)}catch(o){t={success:!1}}return t}}}(window,document);